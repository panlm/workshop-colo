{"api_version":"3.0","metadata":{"categories":{"AppFamily":"DevOps"},"creation_time":"1543480905119082","kind":"blueprint","last_update_time":"1543486737013097","name":"COLO_lamp_BP","spec_version":8},"spec":{"description":"* [Lamp](http:\/\/@@{HAPROXY.address}@@)","name":"COLO_lamp_BP","resources":{"app_profile_list":[{"action_list":[{"critical":false,"description":"","name":"ScaleIn","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"51ca4a45_dag"},"name":"5f546660_runbook","task_definition_list":[{"attrs":{"edges":[{"edge_type":"user_defined","from_task_reference":{"kind":"app_task","name":"Scale In App"},"to_task_reference":{"kind":"app_task","name":"Configure haproxy"},"type":""}],"type":""},"child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure haproxy"},{"kind":"app_task","name":"Scale In App"}],"description":"","name":"51ca4a45_dag","retries":"0","timeout_secs":"0","type":"DAG","variable_list":[]},{"attrs":{"command_line_args":"","exit_status":[],"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"script":"#!\/bin\/bash\nset -ex\n\nsudo setenforce 0\nsudo sed -i 's\/permissive\/disabled\/' \/etc\/sysconfig\/selinux\n\nport=80\n\n\necho \"global\n  log 127.0.0.1 local0\n  log 127.0.0.1 local1 notice\n  maxconn 4096\n  quiet\n  user haproxy\n  group haproxy\ndefaults\n  log     global\n  mode    http\n  retries 3\n  timeout client 50s\n  timeout connect 5s\n  timeout server 50s\n  option dontlognull\n  option httplog\n  option redispatch\n  balance  roundrobin\n# Set up application listeners here.\nlisten stats 0.0.0.0:8080\n  mode http\n  log global\n  stats enable\n  stats hide-version\n  stats refresh 30s\n  stats show-node\n  stats uri \/stats\nlisten admin\n  bind 127.0.0.1:22002\n  mode http\n  stats uri \/\nfrontend http\n  maxconn 2000\n  bind 0.0.0.0:80\n  default_backend servers-http\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\n\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\n\nhosts=$(echo \"@@{APACHE_PHP.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\n\n\nfor host in $hosts\ndo\n   echo \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\ndone\n\nsudo systemctl daemon-reload\nsudo systemctl enable haproxy\nsudo systemctl restart haproxy\n","script_type":"sh","type":""},"child_tasks_local_reference_list":[],"description":"","name":"Configure haproxy","retries":"0","target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"attrs":{"scaling_count":"@@{COUNT}@@","scaling_type":"SCALEIN","type":""},"child_tasks_local_reference_list":[],"description":"","name":"Scale In App","retries":"0","target_any_local_reference":{"kind":"app_blueprint_deployment","name":"7df0cc1c_deployment"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"variable_list":[{"attrs":{"type":""},"description":"","editables":{"value":true},"label":"","name":"COUNT","type":"LOCAL","val_type":"STRING","value":"1"}]},"type":"user"},{"critical":false,"description":"","name":"ScaleOut","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"788fce62_dag"},"name":"8a03e7aa_runbook","task_definition_list":[{"attrs":{"edges":[{"edge_type":"user_defined","from_task_reference":{"kind":"app_task","name":"Scale Out App"},"to_task_reference":{"kind":"app_task","name":"Configure haproxy"},"type":""}],"type":""},"child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure haproxy"},{"kind":"app_task","name":"Scale Out App"}],"description":"","name":"788fce62_dag","retries":"0","timeout_secs":"0","type":"DAG","variable_list":[]},{"attrs":{"command_line_args":"","exit_status":[],"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"script":"#!\/bin\/bash\nset -ex\n\nsudo setenforce 0\nsudo sed -i 's\/permissive\/disabled\/' \/etc\/sysconfig\/selinux\n\nport=80\n\n\necho \"global\n  log 127.0.0.1 local0\n  log 127.0.0.1 local1 notice\n  maxconn 4096\n  quiet\n  user haproxy\n  group haproxy\ndefaults\n  log     global\n  mode    http\n  retries 3\n  timeout client 50s\n  timeout connect 5s\n  timeout server 50s\n  option dontlognull\n  option httplog\n  option redispatch\n  balance  roundrobin\n# Set up application listeners here.\nlisten stats 0.0.0.0:8080\n  mode http\n  log global\n  stats enable\n  stats hide-version\n  stats refresh 30s\n  stats show-node\n  stats uri \/stats\nlisten admin\n  bind 127.0.0.1:22002\n  mode http\n  stats uri \/\nfrontend http\n  maxconn 2000\n  bind 0.0.0.0:80\n  default_backend servers-http\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\n\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\n\nhosts=$(echo \"@@{APACHE_PHP.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\n\n\nfor host in $hosts\ndo\n   echo \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\ndone\n\nsudo systemctl daemon-reload\nsudo systemctl enable haproxy\nsudo systemctl restart haproxy\n","script_type":"sh","type":""},"child_tasks_local_reference_list":[],"description":"","name":"Configure haproxy","retries":"0","target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"attrs":{"scaling_count":"@@{COUNT}@@","scaling_type":"SCALEOUT","type":""},"child_tasks_local_reference_list":[],"description":"","name":"Scale Out App","retries":"0","target_any_local_reference":{"kind":"app_blueprint_deployment","name":"7df0cc1c_deployment"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"variable_list":[{"attrs":{"type":""},"description":"","editables":{"value":true},"label":"","name":"COUNT","type":"LOCAL","val_type":"STRING","value":"1"}]},"type":"user"}],"deployment_create_list":[{"action_list":[],"depends_on_list":[],"description":"","max_replicas":"1","min_replicas":"1","name":"4d96f2c3_deployment","package_local_reference_list":[{"kind":"app_package","name":"HAPROXY_PACKAGE"}],"published_service_local_reference_list":[],"substrate_local_reference":{"kind":"app_substrate","name":"HAPROXYAHV"},"type":"GREENFIELD","variable_list":[]},{"action_list":[],"depends_on_list":[],"description":"","editables":{"max_replicas":true,"min_replicas":true},"max_replicas":"40","min_replicas":"2","name":"7df0cc1c_deployment","package_local_reference_list":[{"kind":"app_package","name":"APACHE_PHP_PACKAGE"}],"published_service_local_reference_list":[],"substrate_local_reference":{"kind":"app_substrate","name":"APACHE_PHP_AHV"},"type":"GREENFIELD","variable_list":[]},{"action_list":[],"depends_on_list":[],"description":"","max_replicas":"1","min_replicas":"1","name":"cbc66a9b_deployment","package_local_reference_list":[{"kind":"app_package","name":"MYSQL_PACKAGE"}],"published_service_local_reference_list":[],"substrate_local_reference":{"kind":"app_substrate","name":"MYSQLAHV"},"type":"GREENFIELD","variable_list":[]}],"description":"","name":"Nutanix","variable_list":[{"attrs":{"type":""},"description":"","editables":{"value":true},"label":"","name":"INSTANCE_PUBLIC_KEY","type":"LOCAL","val_type":"STRING","value":"ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEApFiiPDXZ\/in4yknwl33rQkVi3Oo4X\/78ekW93+gGptbV1wCj\/PFay85\/aMA98ZYaAxXoC+MHe3QgUuXER45poH552IWdF0tU7X\/t0jH5KllVFx2yuFzCcjw1aKwdxKagDLX5jP4QvNsvB9pKx4dwECBp4qlKW4cpl\/2cWEpUqRi67PVDYr3TMt\/OCac6FaAMs5Du3N2HhGiWh2wezqUCRameLdni1\/G3ovaKpGL+c68n0peBsK63AJEa+AjVfpFcz6kzEUUMGSvAWD2d5nKCkJzqfBgh6kFJUTXPX0YnorbGsp1SuxmLy1pD7RXh2it5IPFUAFgEQfBwJJd7L4UkWQ== root@centos"},{"description":"","editables":{"value":true},"label":"","name":"MYSQL_PASSWORD","type":"LOCAL","val_type":"STRING","value":"nutanix"}]}],"client_attrs":{"126d8a72-1400-47a8-a7eb-e923ce41f6ca":{"x":316,"y":279},"39cc8c73-213a-4a2b-8a94-e256981f3eb4":{"x":-92,"y":22},"3b4b25ca-1f15-4d24-8314-a8fa62f3ee27":{"x":-92,"y":22},"3e629118-d096-495a-bd07-452b3fc92c0f":{"x":-92,"y":22},"4d96f2c3_deployment":{"x":-92,"y":22},"7df0cc1c_deployment":{"x":125,"y":130},"c3d8be52-3300-4d59-853f-b85b6c747a4c":{"x":125,"y":130},"c7067a91-101f-43d8-bb4b-d29cb81548e8":{"x":125,"y":130},"c771b506-be68-40f4-91f9-7951a690b7ad":{"x":316,"y":279},"cbc66a9b_deployment":{"x":316,"y":279},"d4336fd5-684c-4b56-8e19-75cacb048f7e":{"x":125,"y":130},"e3741b7d-4efa-4d9a-b89e-17406ca23664":{"x":316,"y":279}},"credential_definition_list":[{"description":"","editables":{"secret":true,"username":true},"name":"CENTOS","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"type":"KEY","username":"centos"}],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"package_definition_list":[{"action_list":[],"description":"","name":"APACHE_PHP_PACKAGE","options":{"install_runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"27550204_dag"},"message_list":[],"name":"124852e5_runbook","state":"ACTIVE","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[{"kind":"app_task","name":"PackageInstallTask"}],"description":"","message_list":[],"name":"27550204_dag","retries":"0","state":"ACTIVE","target_any_local_reference":{"kind":"app_package","name":"APACHE_PHP_PACKAGE"},"timeout_secs":"0","type":"DAG","variable_list":[]},{"attrs":{"command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n# -*- Install httpd and php\nsudo yum update -y\nsudo yum -y install epel-release\nsudo rpm -Uvh https:\/\/mirror.webtatic.com\/yum\/el7\/webtatic-release.rpm\nsudo yum install -y httpd php56w php56w-mysql\n\necho \"<IfModule mod_dir.c>\n        DirectoryIndex index.php index.html index.cgi index.pl index.php index.xhtml index.htm\n<\/IfModule>\" | sudo tee \/etc\/httpd\/conf.modules.d\/dir.conf\n\necho \"<?php\nphpinfo();\n?>\" | sudo tee \/var\/www\/html\/info.php \nsudo systemctl restart httpd\nsudo systemctl enable httpd","script_type":"sh","type":""},"child_tasks_local_reference_list":[],"description":"","message_list":[],"name":"PackageInstallTask","retries":"0","state":"ACTIVE","target_any_local_reference":{"kind":"app_package","name":"APACHE_PHP_PACKAGE"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"variable_list":[]},"type":"","uninstall_runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"11c3b039_dag"},"message_list":[],"name":"afe7faff_runbook","state":"ACTIVE","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","message_list":[],"name":"11c3b039_dag","retries":"0","state":"ACTIVE","target_any_local_reference":{"kind":"app_package","name":"APACHE_PHP_PACKAGE"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]}},"service_local_reference_list":[{"kind":"app_service","name":"APACHE_PHP"}],"type":"DEB","variable_list":[],"version":""},{"action_list":[],"description":"","name":"CENTOS_IMAGE","options":{"description":"","name":"Centos-7.4-1801-01","resources":{"architecture":"X86_64","checksum":{"checksum_algorithm":"","checksum_value":"","type":""},"image_type":"DISK_IMAGE","source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-GenericCloud-1801-01.qcow2","type":"","version":{"product_name":"","product_version":"","type":""}},"type":""},"service_local_reference_list":[],"type":"SUBSTRATE_IMAGE","variable_list":[],"version":""},{"action_list":[],"description":"","name":"HAPROXY_PACKAGE","options":{"install_runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"feefd61c_dag"},"message_list":[],"name":"0f3b1d56_runbook","state":"ACTIVE","task_definition_list":[{"attrs":{"command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo setenforce 0\nsudo sed -i 's\/permissive\/disabled\/' \/etc\/sysconfig\/selinux\n\nport=80\nsudo yum update -y\nsudo yum install -y haproxy\n\necho \"global\n  log 127.0.0.1 local0\n  log 127.0.0.1 local1 notice\n  maxconn 4096\n  quiet\n  user haproxy\n  group haproxy\ndefaults\n  log     global\n  mode    http\n  retries 3\n  timeout client 50s\n  timeout connect 5s\n  timeout server 50s\n  option dontlognull\n  option httplog\n  option redispatch\n  balance  roundrobin\n# Set up application listeners here.\nlisten stats 0.0.0.0:8080\n  mode http\n  log global\n  stats enable\n  stats hide-version\n  stats refresh 30s\n  stats show-node\n  stats uri \/stats\nlisten admin\n  bind 127.0.0.1:22002\n  mode http\n  stats uri \/\nfrontend http\n  maxconn 2000\n  bind 0.0.0.0:80\n  default_backend servers-http\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\n\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\n\nhosts=$(echo \"@@{APACHE_PHP.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\n\n\nfor host in $hosts\ndo\n   echo \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\ndone\n\nsudo systemctl daemon-reload\nsudo systemctl enable haproxy\nsudo systemctl restart haproxy\n","script_type":"sh","type":""},"child_tasks_local_reference_list":[],"description":"","message_list":[],"name":"PackageInstallTask","retries":"0","state":"ACTIVE","target_any_local_reference":{"kind":"app_package","name":"HAPROXY_PACKAGE"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[{"kind":"app_task","name":"PackageInstallTask"}],"description":"","message_list":[],"name":"feefd61c_dag","retries":"0","state":"ACTIVE","target_any_local_reference":{"kind":"app_package","name":"HAPROXY_PACKAGE"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"","uninstall_runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"b0165015_dag"},"message_list":[],"name":"77f817b9_runbook","state":"ACTIVE","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","message_list":[],"name":"b0165015_dag","retries":"0","state":"ACTIVE","target_any_local_reference":{"kind":"app_package","name":"HAPROXY_PACKAGE"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]}},"service_local_reference_list":[{"kind":"app_service","name":"HAPROXY"}],"type":"DEB","variable_list":[],"version":""},{"action_list":[],"description":"","name":"MYSQL_PACKAGE","options":{"install_runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"696811b8_dag"},"message_list":[],"name":"fa139f70_runbook","state":"ACTIVE","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[{"kind":"app_task","name":"PackageInstallTask"}],"description":"","message_list":[],"name":"696811b8_dag","retries":"0","state":"ACTIVE","target_any_local_reference":{"kind":"app_package","name":"MYSQL_PACKAGE"},"timeout_secs":"0","type":"DAG","variable_list":[]},{"attrs":{"command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n\n# -*- Mysql installation \nsudo yum install -y \"http:\/\/repo.mysql.com\/mysql-community-release-el7.rpm\"\nsudo yum update -y\nsudo yum remove -y mysql-community-common* mysql-community-lib*\nsudo yum install -y mysql-community-server\nsudo systemctl start mysqld\nsudo systemctl enable mysqld\n\n#PASS=`sudo cat \/var\/log\/mysqld.log |grep -i 'temporary password' |awk '{print $NF}'`\n\n# -*- Mysql secure installation\nsudo mysql -u root <<-EOF\nUPDATE mysql.user SET Password=PASSWORD('@@{MYSQL_PASSWORD}@@') WHERE User='root';\nDELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');\nDELETE FROM mysql.user WHERE User='';\nDELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';\nFLUSH PRIVILEGES;\nEOF\n","script_type":"sh","type":""},"child_tasks_local_reference_list":[],"description":"","message_list":[],"name":"PackageInstallTask","retries":"0","state":"ACTIVE","target_any_local_reference":{"kind":"app_package","name":"MYSQL_PACKAGE"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"variable_list":[]},"type":"","uninstall_runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"9f5b6937_dag"},"message_list":[],"name":"add53bd1_runbook","state":"ACTIVE","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","message_list":[],"name":"9f5b6937_dag","retries":"0","state":"ACTIVE","target_any_local_reference":{"kind":"app_package","name":"MYSQL_PACKAGE"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]}},"service_local_reference_list":[{"kind":"app_service","name":"MYSQL"}],"type":"DEB","variable_list":[],"version":""}],"published_service_definition_list":[],"service_definition_list":[{"action_list":[{"critical":false,"description":"System action for creating an application","name":"action_create","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"9807fe1b_dag"},"name":"a992bd98_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"9807fe1b_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"},{"critical":false,"description":"System action for deleting an application. Deletes created VMs as well","name":"action_delete","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"d3ab8fc3_dag"},"name":"4fd20db5_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"d3ab8fc3_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"},{"critical":false,"description":"System action for restarting an application","name":"action_restart","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"208adab8_dag"},"name":"4e962233_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"208adab8_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"},{"critical":false,"description":"System action for starting an application","name":"action_start","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"bfc74f9b_dag"},"name":"e4dbbc0a_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"bfc74f9b_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"},{"critical":false,"description":"System action for stopping an application","name":"action_stop","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"a5bfd22c_dag"},"name":"0ecebc2f_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"a5bfd22c_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"}],"depends_on_list":[{"kind":"app_service","name":"MYSQL"}],"description":"","name":"APACHE_PHP","port_list":[],"singleton":false,"tier":"","variable_list":[]},{"action_list":[{"critical":false,"description":"System action for creating an application","name":"action_create","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"0ffc772f_dag"},"name":"0b37647d_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"0ffc772f_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"},{"critical":false,"description":"System action for deleting an application. Deletes created VMs as well","name":"action_delete","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"345bfe30_dag"},"name":"42c025e9_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"345bfe30_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"},{"critical":false,"description":"System action for restarting an application","name":"action_restart","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"9f7ae67d_dag"},"name":"5bb47e63_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"9f7ae67d_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"},{"critical":false,"description":"System action for starting an application","name":"action_start","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"8d2423f8_dag"},"name":"4f6625e7_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"8d2423f8_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"},{"critical":false,"description":"System action for stopping an application","name":"action_stop","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"a483ed49_dag"},"name":"ac17cd03_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"a483ed49_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"}],"depends_on_list":[{"kind":"app_service","name":"APACHE_PHP"}],"description":"","name":"HAPROXY","port_list":[],"singleton":false,"tier":"","variable_list":[]},{"action_list":[{"critical":false,"description":"System action for creating an application","name":"action_create","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"614e22c6_dag"},"name":"55798d8c_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"614e22c6_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"},{"critical":false,"description":"System action for deleting an application. Deletes created VMs as well","name":"action_delete","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"7d839765_dag"},"name":"631cf0ea_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"7d839765_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"},{"critical":false,"description":"System action for restarting an application","name":"action_restart","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"e9e7d2d3_dag"},"name":"65ac9163_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"e9e7d2d3_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"},{"critical":false,"description":"System action for starting an application","name":"action_start","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"075e4b33_dag"},"name":"68b3c509_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"075e4b33_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"},{"critical":false,"description":"System action for stopping an application","name":"action_stop","runbook":{"description":"","main_task_local_reference":{"kind":"app_task","name":"c857778e_dag"},"name":"94704c3b_runbook","task_definition_list":[{"attrs":{"edges":[],"type":""},"child_tasks_local_reference_list":[],"description":"","name":"c857778e_dag","retries":"0","target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"timeout_secs":"0","type":"DAG","variable_list":[]}],"variable_list":[]},"type":"system"}],"depends_on_list":[],"description":"","name":"MYSQL","port_list":[],"singleton":false,"tier":"","variable_list":[]}],"substrate_definition_list":[{"action_list":[],"create_spec":{"availability_zone_reference":null,"backup_policy":null,"categories":"","cluster_reference":null,"name":"APACHE_PHP@@{calm_array_index}@@","resources":{"boot_config":{"boot_device":{"disk_address":{"adapter_type":"SCSI","device_index":0,"type":""},"type":""},"mac_address":"","type":""},"disk_list":[{"data_source_reference":{"kind":"image","name":"my-img-52","type":"","uuid":"a0a6a1de-a2a9-4191-9e5b-ca94f109c1fc"},"device_properties":{"device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""},"type":""},"disk_size_mib":0,"type":"","volume_group_reference":null}],"gpu_list":[],"guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"sysprep":null,"type":""},"guest_tools":null,"hardware_clock_timezone":"","memory_size_mib":4096,"nic_list":[{"ip_endpoint_list":[],"mac_address":"","network_function_chain_reference":null,"network_function_nic_type":"INGRESS","nic_type":"NORMAL_NIC","subnet_reference":{"kind":"subnet","name":"","type":"","uuid":"ca13c531-07a4-4bd0-8602-25e4c1ce74e8"},"type":""}],"num_sockets":2,"num_vcpus_per_socket":2,"parent_reference":null,"power_state":"ON","serial_port_list":[],"type":""},"type":""},"description":"","editables":{"create_spec":{"name":true,"resources":{"disk_list":{"0":{"data_source_reference":true,"device_properties":{"device_type":true,"disk_address":{"adapter_type":true}}}},"guest_customization":true,"memory_size_mib":true,"nic_list":{},"num_sockets":true,"num_vcpus_per_socket":true,"serial_port_list":{}}},"readiness_probe":{"timeout_secs":true}},"name":"APACHE_PHP_AHV","os_type":"Linux","readiness_probe":{"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","connection_port":22,"connection_type":"SSH","delay_secs":"100","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"type":"AHV_VM","variable_list":[]},{"action_list":[],"create_spec":{"availability_zone_reference":null,"backup_policy":null,"categories":"","cluster_reference":null,"name":"HAPROXY","resources":{"boot_config":{"boot_device":{"disk_address":{"adapter_type":"SCSI","device_index":0,"type":""},"type":""},"mac_address":"","type":""},"disk_list":[{"data_source_reference":{"kind":"image","name":"my-img-52","type":"","uuid":"a0a6a1de-a2a9-4191-9e5b-ca94f109c1fc"},"device_properties":{"device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""},"type":""},"disk_size_mib":0,"type":"","volume_group_reference":null}],"gpu_list":[],"guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"sysprep":null,"type":""},"guest_tools":null,"hardware_clock_timezone":"","memory_size_mib":4096,"nic_list":[{"ip_endpoint_list":[],"mac_address":"","network_function_chain_reference":null,"network_function_nic_type":"INGRESS","nic_type":"NORMAL_NIC","subnet_reference":{"kind":"subnet","name":"","type":"","uuid":"ca13c531-07a4-4bd0-8602-25e4c1ce74e8"},"type":""}],"num_sockets":2,"num_vcpus_per_socket":1,"parent_reference":null,"power_state":"ON","serial_port_list":[],"type":""},"type":""},"description":"","editables":{"create_spec":{"name":true,"resources":{"disk_list":{"0":{"data_source_reference":true,"device_properties":{"device_type":true,"disk_address":{"adapter_type":true}}}},"guest_customization":true,"memory_size_mib":true,"nic_list":{},"num_sockets":true,"num_vcpus_per_socket":true,"serial_port_list":{}}},"readiness_probe":{"timeout_secs":true}},"name":"HAPROXYAHV","os_type":"Linux","readiness_probe":{"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","connection_port":22,"connection_type":"SSH","delay_secs":"100","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"type":"AHV_VM","variable_list":[]},{"action_list":[],"create_spec":{"availability_zone_reference":null,"backup_policy":null,"categories":"","cluster_reference":null,"name":"MYSQL","resources":{"boot_config":{"boot_device":{"disk_address":{"adapter_type":"SCSI","device_index":0,"type":""},"type":""},"mac_address":"","type":""},"disk_list":[{"data_source_reference":{"kind":"image","name":"my-img-52","type":"","uuid":"a0a6a1de-a2a9-4191-9e5b-ca94f109c1fc"},"device_properties":{"device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""},"type":""},"disk_size_mib":0,"type":"","volume_group_reference":null}],"gpu_list":[],"guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"sysprep":null,"type":""},"guest_tools":null,"hardware_clock_timezone":"","memory_size_mib":4096,"nic_list":[{"ip_endpoint_list":[],"mac_address":"","network_function_chain_reference":null,"network_function_nic_type":"INGRESS","nic_type":"NORMAL_NIC","subnet_reference":{"kind":"subnet","name":"","type":"","uuid":"ca13c531-07a4-4bd0-8602-25e4c1ce74e8"},"type":""}],"num_sockets":2,"num_vcpus_per_socket":2,"parent_reference":null,"power_state":"ON","serial_port_list":[],"type":""},"type":""},"description":"","editables":{"create_spec":{"name":true,"resources":{"disk_list":{"0":{"data_source_reference":true,"device_properties":{"device_type":true,"disk_address":{"adapter_type":true}}}},"guest_customization":true,"memory_size_mib":true,"nic_list":{},"num_sockets":true,"num_vcpus_per_socket":true,"serial_port_list":{}}},"readiness_probe":{"timeout_secs":true}},"name":"MYSQLAHV","os_type":"Linux","readiness_probe":{"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","connection_port":22,"connection_type":"SSH","delay_secs":"100","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"type":"AHV_VM","variable_list":[]}],"type":"USER"}},"status":{}}